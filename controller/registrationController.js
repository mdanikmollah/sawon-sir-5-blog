const bcrypt = require('bcrypt');
const User = require("../model/userModel.js")
const nodemailer = require("nodemailer");
const registrationController = async (req, res) => {
    let { name, email, password } = req.body;
    //console.log(password.length);
    // if (password.length < 6) {
    //     res.send("password length must be greater then 5")
    // }
    // let pattern =/^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*\W)(?!.* ).{8,16}$/
    //     console.log(pattern.test(password));

    // let numeric = /(?=.*[0-9])/;
    // let lower = /(?=.*[a-z])/;
    // let capital = /(?=.*[A-Z])/;
    // let symbol = /(?=.*\W)/;
    // let carecter = /.{8,16}/;

    //      if (!numeric.test(password)) {
    //         return res.send("Need a number ") 
    //     }
    //     if (!lower.test(password)) {
    //         return res.send("Need a lowercase ") 
    //     }
    //     if (!capital.test(password)) {
    //         return res.send("Need a capital letter ") 
    //     }
    //     if (!symbol.test(password)) {
    //         return res.send("Need a symbol ") 
    //     }
    //     if (!carecter.test(password)) {
    //         return res.send("the password must be 8-16 characters long ") 
    //     }
        
        
    //console.log(password);
    
    // bcrypt.compare(password, "$2b$10$3sQdC4E.xhSD39gx9H4LXO/IAb7Gak8/LSXPWKJTuGK43bvGyu90ih", function(err, result) {
    //     console.log(result);
    // });
    // console.log(name, email, password);
    if (name == "" || name == undefined) {
       return res.send("Name is required");
    } else if (email == "" || email == undefined) {
       return res.send("Email is required");
    // }else if (!pattern.test(email)) {
    //     return res.send("Email is invalid");
     }else if (password == "" || password == undefined) {
       return res.send("Password is required");
    }
    
    let existingUser = await User.findOne({email:email})
    if (existingUser != null) {
        return res.send("User Already Exists")
    }
   
        bcrypt.hash(password, 10, async function(err, hash) {
            console.log(hash);
            let user = new User({
                name:name,
                email:email,
                password:hash
            })
            user.save()
            const transporter = nodemailer.createTransport({
                service: "gmail",
                auth: {
                  user: "mdanik0178@gmail.com",
                  pass: "edrq gmnm edol vfvn",
                },
              });
              
              
                const info = await transporter.sendMail({
                  from: 'MyBlog', // sender address
                  to:user.email, // list of receivers
                  subject: "Email verification link", // Subject line
                  html: `<meta content="text/html; charset=UTF-8"http-equiv=Content-Type><meta content="width=device-width,initial-scale=1"name=viewport><meta name=x-apple-disable-message-reformatting><title>Hello</title><style>@media only screen and (min-width:620px){.u-row{width:600px!important}.u-row .u-col{vertical-align:top}.u-row .u-col-50{width:300px!important}.u-row .u-col-100{width:600px!important}}@media (max-width:620px){.u-row-container{max-width:100%!important;padding-left:0!important;padding-right:0!important}.u-row .u-col{min-width:320px!important;max-width:100%!important;display:block!important}.u-row{width:100%!important}.u-col{width:100%!important}.u-col>div{margin:0 auto}}body{margin:0;padding:0}table,td,tr{vertical-align:top;border-collapse:collapse}p{margin:0}.ie-container table,.mso-container table{table-layout:fixed}*{line-height:inherit}a[x-apple-data-detectors=true]{color:inherit!important;text-decoration:none!important}table,td{color:#000}#u_body a{color:#161a39;text-decoration:underline}</style><link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"rel=stylesheet><link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap"rel=stylesheet><body class="clean-body u_body"style=margin:0;padding:0;-webkit-text-size-adjust:100%;background-color:#f9f9f9;color:#000><table cellpadding=0 cellspacing=0 style="border-collapse:collapse;table-layout:fixed;border-spacing:0;mso-table-lspace:0;mso-table-rspace:0;vertical-align:top;min-width:320px;Margin:0 auto;background-color:#f9f9f9;width:100%"id=u_body><tr style=vertical-align:top><td style=word-break:break-word;border-collapse:collapse!important;vertical-align:top><div style=padding:0;background-color:#f9f9f9 class=u-row-container><div style="margin:0 auto;min-width:320px;max-width:600px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;background-color:#f9f9f9"class=u-row><div style=border-collapse:collapse;display:table;width:100%;height:100%;background-color:transparent><div style=max-width:320px;min-width:600px;display:table-cell;vertical-align:top class="u-col u-col-100"><div style=height:100%;width:100%!important><div style="box-sizing:border-box;height:100%;padding:0;border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;border-bottom:0 solid transparent"><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style=overflow-wrap:break-word;word-break:break-word;padding:15px;font-family:Lato,sans-serif align=left><table cellpadding=0 cellspacing=0 border=0 width=100% style="border-collapse:collapse;table-layout:fixed;border-spacing:0;mso-table-lspace:0;mso-table-rspace:0;vertical-align:top;border-top:1px solid #f9f9f9;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%"align=center height=0px><tr style=vertical-align:top><td style=word-break:break-word;border-collapse:collapse!important;vertical-align:top;font-size:0;line-height:0;mso-line-height-rule:exactly;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%><span> </span></table></table></div></div></div></div></div></div><div style=padding:0;background-color:transparent class=u-row-container><div style="margin:0 auto;min-width:320px;max-width:600px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;background-color:#fff"class=u-row><div style=border-collapse:collapse;display:table;width:100%;height:100%;background-color:transparent><div style=max-width:320px;min-width:600px;display:table-cell;vertical-align:top class="u-col u-col-100"><div style=height:100%;width:100%!important><div style="box-sizing:border-box;height:100%;padding:0;border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;border-bottom:0 solid transparent"><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:25px 10px;font-family:Lato,sans-serif"align=left><table cellpadding=0 cellspacing=0 border=0 width=100%><tr><td style=padding-right:0;padding-left:0 align=center><img alt=Image src=images/image-1.jpeg style=outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;clear:both;display:inline-block!important;border:none;height:auto;float:none;width:29%;max-width:168.2px title=Image width=168.2 align=center border=0></table></table></div></div></div></div></div></div><div style=padding:0;background-color:transparent class=u-row-container><div style="margin:0 auto;min-width:320px;max-width:600px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;background-color:#161a39"class=u-row><div style=border-collapse:collapse;display:table;width:100%;height:100%;background-color:transparent><div style=max-width:320px;min-width:600px;display:table-cell;vertical-align:top class="u-col u-col-100"><div style=height:100%;width:100%!important><div style="box-sizing:border-box;height:100%;padding:0;border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;border-bottom:0 solid transparent"><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:35px 10px 10px;font-family:Lato,sans-serif"align=left><table cellpadding=0 cellspacing=0 border=0 width=100%><tr><td style=padding-right:0;padding-left:0 align=center><img alt=Image src=images/image-2.png style=outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;clear:both;display:inline-block!important;border:none;height:auto;float:none;width:10%;max-width:58px title=Image width=58 align=center border=0></table></table><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:0 10px 30px;font-family:Lato,sans-serif"align=left><div style=font-size:14px;line-height:140%;text-align:left;word-wrap:break-word><p style=font-size:14px;line-height:140%;text-align:center><span style=font-size:28px;line-height:39.2px;color:#fff;font-family:Lato,sans-serif>Hey ! ${user.name}, your verify link: <a href ="http://localhost:8000/${user.email}">Click Here</a></span></div></table></div></div></div></div></div></div><div style=padding:0;background-color:transparent class=u-row-container><div style="margin:0 auto;min-width:320px;max-width:600px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;background-color:#fff"class=u-row><div style=border-collapse:collapse;display:table;width:100%;height:100%;background-color:transparent><div style=max-width:320px;min-width:600px;display:table-cell;vertical-align:top class="u-col u-col-100"><div style=height:100%;width:100%!important><div style="box-sizing:border-box;height:100%;padding:0;border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;border-bottom:0 solid transparent"><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:40px 40px 30px;font-family:Lato,sans-serif"align=left><div style=font-size:14px;line-height:140%;text-align:left;word-wrap:break-word><p style=font-size:14px;line-height:140%><span style=font-size:18px;line-height:25.2px;color:#666>Hello,</span><p style=font-size:14px;line-height:140%> <p style=font-size:14px;line-height:140%><span style=font-size:18px;line-height:25.2px;color:#666>We have sent you this email in response to your request to reset your password on company name.</span><p style=font-size:14px;line-height:140%> <p style=font-size:14px;line-height:140%><span style=font-size:18px;line-height:25.2px;color:#666>To reset your password, please follow the link below:</span></div></table><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:0 40px;font-family:Lato,sans-serif"align=left><div align=left><a href=""target=_blank class=v-button style=box-sizing:border-box;display:inline-block;text-decoration:none;-webkit-text-size-adjust:none;text-align:center;color:#fff;background-color:#18163a;border-radius:1px;-webkit-border-radius:1px;-moz-border-radius:1px;width:auto;max-width:100%;overflow-wrap:break-word;word-break:break-word;word-wrap:break-word;mso-border-alt:none;font-size:14px><span style="display:block;padding:15px 40px;line-height:120%"><span style=font-size:18px;line-height:21.6px>Reset Password</span></span></a></div></table><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:40px 40px 30px;font-family:Lato,sans-serif"align=left><div style=font-size:14px;line-height:140%;text-align:left;word-wrap:break-word><p style=font-size:14px;line-height:140%><span style=color:#888;font-size:14px;line-height:19.6px><em><span style=font-size:16px;line-height:22.4px>Please ignore this email if you did not request a password change.</span></em></span><br><span style=color:#888;font-size:14px;line-height:19.6px><em><span style=font-size:16px;line-height:22.4px> </span></em></span></div></table></div></div></div></div></div></div><div style=padding:0;background-color:transparent class=u-row-container><div style="margin:0 auto;min-width:320px;max-width:600px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;background-color:#18163a"class=u-row><div style=border-collapse:collapse;display:table;width:100%;height:100%;background-color:transparent><div style=max-width:320px;min-width:300px;display:table-cell;vertical-align:top class="u-col u-col-50"><div style=height:100%;width:100%!important><div style="box-sizing:border-box;height:100%;padding:20px 20px 0;border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;border-bottom:0 solid transparent"><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style=overflow-wrap:break-word;word-break:break-word;padding:10px;font-family:Lato,sans-serif align=left><div style=font-size:14px;line-height:140%;text-align:left;word-wrap:break-word><p style=font-size:14px;line-height:140%><span style=font-size:16px;line-height:22.4px;color:#ecf0f1>Contact</span><p style=font-size:14px;line-height:140%><span style=font-size:14px;line-height:19.6px;color:#ecf0f1>1912  Mcwhorter Road, FL 11223</span><p style=font-size:14px;line-height:140%><span style=font-size:14px;line-height:19.6px;color:#ecf0f1>+111 222 333 | Info@company.com</span></div></table></div></div></div><div style=max-width:320px;min-width:300px;display:table-cell;vertical-align:top class="u-col u-col-50"><div style=height:100%;width:100%!important><div style="box-sizing:border-box;height:100%;padding:0 0 0 20px;border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;border-bottom:0 solid transparent"><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:25px 10px 10px;font-family:Lato,sans-serif"align=left><div align=left><div style=display:table;max-width:187px><table cellpadding=0 cellspacing=0 border=0 width=32 style=width:32px!important;height:32px!important;display:inline-block;border-collapse:collapse;table-layout:fixed;border-spacing:0;mso-table-lspace:0;mso-table-rspace:0;vertical-align:top;margin-right:15px align=left height=32><tr style=vertical-align:top><td style=word-break:break-word;border-collapse:collapse!important;vertical-align:top align=left valign=middle><a href=""target=_blank title=Facebook><img alt=Facebook src=images/image-3.png style=outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;clear:both;display:block!important;border:none;height:auto;float:none;max-width:32px!important title=Facebook width=32></a></table><table cellpadding=0 cellspacing=0 border=0 width=32 style=width:32px!important;height:32px!important;display:inline-block;border-collapse:collapse;table-layout:fixed;border-spacing:0;mso-table-lspace:0;mso-table-rspace:0;vertical-align:top;margin-right:15px align=left height=32><tr style=vertical-align:top><td style=word-break:break-word;border-collapse:collapse!important;vertical-align:top align=left valign=middle><a href=""target=_blank title=Twitter><img alt=Twitter src=images/image-4.png style=outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;clear:both;display:block!important;border:none;height:auto;float:none;max-width:32px!important title=Twitter width=32></a></table><table cellpadding=0 cellspacing=0 border=0 width=32 style=width:32px!important;height:32px!important;display:inline-block;border-collapse:collapse;table-layout:fixed;border-spacing:0;mso-table-lspace:0;mso-table-rspace:0;vertical-align:top;margin-right:15px align=left height=32><tr style=vertical-align:top><td style=word-break:break-word;border-collapse:collapse!important;vertical-align:top align=left valign=middle><a href=""target=_blank title=Instagram><img alt=Instagram src=images/image-5.png style=outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;clear:both;display:block!important;border:none;height:auto;float:none;max-width:32px!important title=Instagram width=32></a></table><table cellpadding=0 cellspacing=0 border=0 width=32 style=width:32px!important;height:32px!important;display:inline-block;border-collapse:collapse;table-layout:fixed;border-spacing:0;mso-table-lspace:0;mso-table-rspace:0;vertical-align:top;margin-right:0 align=left height=32><tr style=vertical-align:top><td style=word-break:break-word;border-collapse:collapse!important;vertical-align:top align=left valign=middle><a href=""target=_blank title=LinkedIn><img alt=LinkedIn src=images/image-6.png style=outline:0;text-decoration:none;-ms-interpolation-mode:bicubic;clear:both;display:block!important;border:none;height:auto;float:none;max-width:32px!important title=LinkedIn width=32></a></table></div></div></table><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:5px 10px 10px;font-family:Lato,sans-serif"align=left><div style=font-size:14px;line-height:140%;text-align:left;word-wrap:break-word><p style=line-height:140%;font-size:14px><span style=font-size:14px;line-height:19.6px><span style=color:#ecf0f1;font-size:14px;line-height:19.6px><span style=line-height:19.6px;font-size:14px>Company ©  All Rights Reserved</span></span></span></div></table></div></div></div></div></div></div><div style=padding:0;background-color:#f9f9f9 class=u-row-container><div style="margin:0 auto;min-width:320px;max-width:600px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;background-color:#1c103b"class=u-row><div style=border-collapse:collapse;display:table;width:100%;height:100%;background-color:transparent><div style=max-width:320px;min-width:600px;display:table-cell;vertical-align:top class="u-col u-col-100"><div style=height:100%;width:100%!important><div style="box-sizing:border-box;height:100%;padding:0;border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;border-bottom:0 solid transparent"><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style=overflow-wrap:break-word;word-break:break-word;padding:15px;font-family:Lato,sans-serif align=left><table cellpadding=0 cellspacing=0 border=0 width=100% style="border-collapse:collapse;table-layout:fixed;border-spacing:0;mso-table-lspace:0;mso-table-rspace:0;vertical-align:top;border-top:1px solid #1c103b;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%"align=center height=0px><tr style=vertical-align:top><td style=word-break:break-word;border-collapse:collapse!important;vertical-align:top;font-size:0;line-height:0;mso-line-height-rule:exactly;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%><span> </span></table></table></div></div></div></div></div></div><div style=padding:0;background-color:transparent class=u-row-container><div style="margin:0 auto;min-width:320px;max-width:600px;overflow-wrap:break-word;word-wrap:break-word;word-break:break-word;background-color:#f9f9f9"class=u-row><div style=border-collapse:collapse;display:table;width:100%;height:100%;background-color:transparent><div style=max-width:320px;min-width:600px;display:table-cell;vertical-align:top class="u-col u-col-100"><div style=height:100%;width:100%!important><div style="box-sizing:border-box;height:100%;padding:0;border-top:0 solid transparent;border-left:0 solid transparent;border-right:0 solid transparent;border-bottom:0 solid transparent"><table cellpadding=0 cellspacing=0 border=0 width=100% style=font-family:Lato,sans-serif role=presentation><tr><td style="overflow-wrap:break-word;word-break:break-word;padding:0 40px 30px 20px;font-family:Lato,sans-serif"align=left><div style=font-size:14px;line-height:140%;text-align:left;word-wrap:break-word></div></table></div></div></div></div></div></div></table>`, // html body
                });
              
                console.log("Message sent: %s", info.messageId);
                // Message sent: <d786aa62-4e0a-070a-47ed-0b0666549519@ethereal.email>
              
            res.send({
                message:"Registration successful",
                id: user._id,
                name:user.name,
                email:user.email
            })
        });
       // res.send("Registration successful");
    
};

module.exports = registrationController;

